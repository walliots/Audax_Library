CREATE TABLE BOOK
(
BOOK_ID INT NOT NULL,
TITLE VARCHAR2(100 BYTE) NOT NULL,
AUTOR VARCHAR2(45 BYTE) NOT NULL,
LAUNCH_DATE DATE NOT NULL,
CONSTRAINT ID_BOOK_PK PRIMARY KEY(BOOK_ID) ENABLE 
);

CREATE SEQUENCE S_ID_BOOK INCREMENT BY 1 START WITH 1 MINVALUE 1;

CREATE OR REPLACE TRIGGER T_ID_BOOK
BEFORE INSERT ON BOOK
   FOR EACH ROW
BEGIN
   IF INSERTING THEN 
    IF :NEW.BOOK_ID IS NULL THEN
     SELECT S_ID_BOOK.NEXTVAL INTO :NEW.BOOK_ID FROM DUAL;
    END IF;
 END IF;
END;

CREATE TABLE STUDENTS
(
ID_STUDENTS INT NOT NULL,
STUDENT_NAME VARCHAR2(45 BYTE) NOT NULL,
SEX VARCHAR2 (3 BYTE) NOT NULL,
BIRTHDAY DATE NOT NULL,
CONSTRAINT ID_STUDENTS_PK PRIMARY KEY(ID_STUDENTS) ENABLE
);

CREATE SEQUENCE S_ID_STUDENTS INCREMENT BY 1 START WITH 1 MINVALUE 1;

CREATE OR REPLACE TRIGGER T_ID_STUDENTS
BEFORE INSERT ON STUDENTS
   FOR EACH ROW
BEGIN
   IF INSERTING THEN 
    IF :NEW.ID_STUDENTS IS NULL THEN
     SELECT S_ID_STUDENTS.NEXTVAL INTO :NEW.ID_STUDENTS FROM DUAL;
    END IF;
 END IF;
END;

CREATE TABLE STUDENTS_ADRESS
(
ID_STUDENTS_ADRESS INT NOT NULL,
ZIP_CODE INT NOT NULL,
ADRESS VARCHAR2(45 BYTE) NOT NULL,
HOUSE_NUMBER INT NOT NULL,
CONSTRAINT ID_STUDENTS_ADRESS_FK FOREIGN KEY (ID_STUDENTS_ADRESS) REFERENCES STUDENTS (ID_STUDENTS) ENABLE
); 

CREATE TABLE LIBRARY_EMPLOYEE
(
EMPLOYEE_ID INT NOT NULL,
EMPLOYEE_NAME VARCHAR2 (45 BYTE) NOT NULL,
CONSTRAINT EMPLOYEE_ID_PK PRIMARY KEY (EMPLOYEE_ID) ENABLE
);

CREATE SEQUENCE S_ID_EMPLOYEE INCREMENT BY 1 START WITH 1 MINVALUE 1;

CREATE OR REPLACE TRIGGER T_ID_EMPLOYEE
BEFORE INSERT ON LIBRARY_EMPLOYEE
   FOR EACH ROW
BEGIN
   IF INSERTING THEN 
    IF :NEW.EMPLOYEE_ID IS NULL THEN
     SELECT S_ID_EMPLOYEE.NEXTVAL INTO :NEW.EMPLOYEE_ID FROM DUAL;
    END IF;
 END IF;
END;

CREATE TABLE BOOK_LENDING_REGISTER
(
BOOK_LENDING_REGISTER_ID INT NOT NULL,
LENDING_DATE DATE NOT NULL,
DEVOLUTION_DATE DATE NOT NULL,
STUDENT_BOOK_LENDING_ID INT NOT NULL,
LIBRARY_EMPLOYEE_ID INT NOT NULL,
BOOK_ID_LENDING INT NOT NULL,
CONSTRAINT STUDENT_BOOK_LENDING_ID_FK FOREIGN KEY(STUDENT_BOOK_LENDING_ID) REFERENCES STUDENTS (ID_STUDENTS),
CONSTRAINT LIBRARY_EMPLOYEE_ID_FK FOREIGN KEY (LIBRARY_EMPLOYEE_ID) REFERENCES LIBRARY_EMPLOYEE (EMPLOYEE_ID),
CONSTRAINT BOOK_ID_LENDING_FK FOREIGN KEY (BOOK_ID_LENDING) REFERENCES BOOK (BOOK_ID),
CONSTRAINT BOOK_LENDING_ID_PK PRIMARY KEY (BOOK_LENDING_REGISTER_ID) ENABLE
);

CREATE SEQUENCE S_ID_BOOK_LENDING INCREMENT BY 1 START WITH 1 MINVALUE 1;

CREATE OR REPLACE TRIGGER T_ID_BOOK_LENDING
BEFORE INSERT ON BOOK_LENDING_REGISTER
   FOR EACH ROW
BEGIN
   IF INSERTING THEN 
    IF :NEW.BOOK_LENDING_REGISTER_ID IS NULL THEN
     SELECT S_ID_BOOK_LENDING.NEXTVAL INTO :NEW.BOOK_LENDING_REGISTER_ID FROM DUAL;
    END IF;
 END IF;
END;

INSERT INTO "LIBRARY"."BOOK" (TITLE, AUTOR, LAUNCH_DATE) VALUES ('Memórias Póstumas de Brás Cubas', 'Machado de Assis', TO_DATE('1891-03-01 11:57:03', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "LIBRARY"."BOOK" (TITLE, AUTOR, LAUNCH_DATE) VALUES ('O Cortiço', 'Machado de Assis', TO_DATE('1890-10-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "LIBRARY"."BOOK" (TITLE, AUTOR, LAUNCH_DATE) VALUES ('Macunaíma', 'Mário de Andrade', TO_DATE('1928-05-06 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));

SELECT*FROM BOOK;


INSERT INTO "LIBRARY"."STUDENTS" (STUDENT_NAME, SEX, BIRTHDAY) VALUES ('João Lima', 'MAS', TO_DATE('2000-09-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "LIBRARY"."STUDENTS" (STUDENT_NAME, SEX, BIRTHDAY) VALUES ('Lana Ferraz', 'FEM', TO_DATE('1997-11-05 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO "LIBRARY"."STUDENTS" (STUDENT_NAME, SEX, BIRTHDAY) VALUES ('Pedro Pereira', 'MAS', TO_DATE('1995-01-12 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));


SELECT*FROM STUDENTS;

INSERT INTO "LIBRARY"."STUDENTS_ADRESS" (ID_STUDENTS_ADRESS, ZIP_CODE, ADRESS, HOUSE_NUMBER) VALUES (1, 51011010, 'RUA QUATRO', 1254);
INSERT INTO "LIBRARY"."STUDENTS_ADRESS" (ID_STUDENTS_ADRESS, ZIP_CODE, ADRESS, HOUSE_NUMBER) VALUES (2, 54523330, 'RUA TRES', 1855);
INSERT INTO "LIBRARY"."STUDENTS_ADRESS" (ID_STUDENTS_ADRESS, ZIP_CODE, ADRESS, HOUSE_NUMBER) VALUES (3, 52541100, 'RUA CINCO', 2630);

SELECT*FROM STUDENTS_ADRESS;

INSERT INTO "LIBRARY"."LIBRARY_EMPLOYEE" (EMPLOYEE_NAME) VALUES ('Paulo Silva');
INSERT INTO "LIBRARY"."LIBRARY_EMPLOYEE" (EMPLOYEE_NAME) VALUES ('Joana Jaque');
INSERT INTO "LIBRARY"."LIBRARY_EMPLOYEE" (EMPLOYEE_NAME) VALUES ('Rafael Augusto');

SELECT*FROM LIBRARY_EMPLOYEE;

INSERT INTO "LIBRARY"."BOOK_LENDING_REGISTER" (LENDING_DATE, DEVOLUTION_DATE, STUDENT_BOOK_LENDING_ID, LIBRARY_EMPLOYEE_ID, BOOK_ID_LENDING) 
VALUES (TO_DATE('2021-11-07 18:29:55', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2021-11-07 18:29:52', 'YYYY-MM-DD HH24:MI:SS'), '1', '2', '10');

SELECT*FROM BOOK_LENDING_REGISTER;
